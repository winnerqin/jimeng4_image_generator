# 剧本分析功能使用指南

## 功能概述

剧本分析功能利用火山引擎的大语言模型（文本模型）自动拆解剧本内容，提取以下信息：
- **人物设定**：识别剧本中的所有人物及其性格、背景描述
- **分镜场景**：按照剧本顺序拆解各个场景，包括场景位置、场景描述、人物出现、视觉设定等

## 使用步骤

### 1. 访问页面
在导航菜单中点击 "🎬 剧本分析" 或直接访问：
```
http://localhost:5000/script-analysis
```

### 2. 输入剧本
在左侧文本框中输入或粘贴你的剧本文本。支持以下格式：
- 自由文本格式的对白和描述
- 标准剧本格式（幕、场景标记）
- 任何可读的故事结构

示例：
```
第一场 豪华办公室

人物：李总、张经理

李总正在看文件，张经理敲门进来。

李总：这个项目怎么样？
张经理：一切都按计划进行，下周可以上线。

第二场 会议室

人物：李总、张经理、王工程师

三人围坐讨论技术方案...
```

### 3. 点击分析
点击 "🔍 分析剧本" 按钮，系统将调用火山引擎大模型进行分析。

### 4. 查看结果
分析结果将显示在右侧区域，包括：
- **人物设定**：列出所有识别的人物及其描述
- **分镜场景**：按场景顺序显示，每个场景包含位置、描述、人物、视觉设定

## 配置说明

### 环境变量配置

编辑 `.env` 文件中的以下参数：

```env
# 火山引擎方舟大模型API配置
ARK_BASE_URL=https://ark.cn-beijing.volces.com/api/v3
ARK_API_KEY=your-api-key-here

# 剧本分析所用模型（必须是文本模型）
SCRIPT_ANALYSIS_MODEL=doubao-seed-1-8-251215
```

### 模型选择

- **推荐模型**：`doubao-seed-1-8-251215`（豆包种子模型1.8版）
- **备选模型**：任何火山引擎支持的文本对话模型
  - `doubao-4-128k-250110`
  - `doubao-lite-8k`
  - 其他可用的文本模型

**注意**：不要使用图片生成模型（如 `doubao-seedream-4-5`）进行文本分析。

## API 端点

### POST /api/analyze-script

分析剧本文本并返回人物和场景信息。

**请求示例**：
```javascript
fetch('/api/analyze-script', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        script: "你的剧本文本"
    })
})
.then(res => res.json())
.then(data => console.log(data))
```

**响应示例**：
```json
{
    "success": true,
    "result": {
        "characters": [
            {
                "name": "李总",
                "description": "公司高管，性格沉稳，决策果断"
            },
            {
                "name": "张经理",
                "description": "项目经理，细心周密，执行力强"
            }
        ],
        "scenes": [
            {
                "location": "豪华办公室",
                "description": "李总在办公桌前看文件，张经理敲门进来汇报工作",
                "characters": ["李总", "张经理"],
                "setting": "现代豪华办公室，大落地窗外是城市景观，办公桌上有电脑和文件"
            },
            {
                "location": "会议室",
                "description": "三人围坐讨论技术方案的可行性",
                "characters": ["李总", "张经理", "王工程师"],
                "setting": "现代会议室，长形会议桌，墙上有投影屏幕，技术配置完善"
            }
        ]
    }
}
```

## 故障排除

### 错误：模型不存在
```
Error code: 404 - The model or endpoint does not exist
```

**解决**：
1. 检查 `.env` 中的 `SCRIPT_ANALYSIS_MODEL` 设置
2. 确保模型名称与你的火山引擎账户中可用的模型一致
3. 尝试使用其他文本模型名称

### 错误：JSON 解析失败
**解决**：
1. 确保火山引擎返回的是有效的 JSON 格式
2. 检查后端日志查看具体的返回内容
3. 尝试使用不同的模型或调整提示词

### 连接超时
**解决**：
1. 检查网络连接
2. 确保 ARK_BASE_URL 和 API_KEY 正确配置
3. 尝试缩短剧本内容或简化提示词

## 最佳实践

1. **剧本格式**：虽然支持任何文本，但结构清晰的剧本会获得更准确的分析结果
2. **剧本长度**：建议剧本内容不超过 5000 字符，以获得最佳分析速度和准确性
3. **人物命名**：使用清晰的人物名称会帮助模型更好地识别
4. **场景标记**：明确的场景标记（如"第一场"、"场景：办公室"）有助于提高分析准确性

## 后续功能规划

- [ ] 支持批量剧本分析
- [ ] 从分析结果直接生成分镜图片
- [ ] 保存分析历史记录
- [ ] 导出分析结果为 PDF 或 Word 文档
- [ ] 与图片生成功能集成，一键生成分镜图片

## 技术细节

- **文本模型**：使用火山引擎的豆包系列大模型进行文本分析
- **温度参数**：设置为 0.7，以平衡准确性和创意性
- **Top-P 采样**：设置为 0.9，确保输出的多样性和准确性

## 相关文档

- [火山引擎方舟大模型 API 文档](https://www.volcengine.com/)
- [Web 应用其他功能说明](./WEB_README.md)
